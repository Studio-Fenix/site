<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Treinos - Studio Fenix</title>
    <link rel="icon" type="image/webp" href="icon.webp">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-gradient: linear-gradient(to bottom, #0a0a0a 0%, #1a1a1a 40%, #800000 100%);
            --text-color: #ffffff;
            --glass-bg: linear-gradient(135deg, rgba(255, 50, 50, 0.15), rgba(100, 0, 0, 0.4));
            --glass-border: rgba(255, 200, 200, 0.25);
            --glass-highlight: rgba(255, 255, 255, 0.3);
            --glass-shadow: 0 8px 32px rgba(0,0,0,0.5);
            --btn-text: #ffffff;
            --green-highlight: #00ff88;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: var(--bg-gradient);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-color);
            padding: 20px;
            padding-bottom: 90px; /* Espa√ßo extra para bot√£o flutuante */
        }

        .container { width: 100%; max-width: 480px; display: flex; flex-direction: column; gap: 20px; }
        
        /* LOGO */
        .header-nav { width: 100%; display: flex; justify-content: center; margin-bottom: 20px; }
        .logo-link { display: block; transition: transform 0.2s; }
        .logo-link:active { transform: scale(0.95); }
        .logo { width: 160px; display: block; filter: drop-shadow(0 0 15px rgba(255,0,0,0.4)); }
        
        .glass-card {
            background: var(--glass-bg); backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border); border-top: 1px solid var(--glass-highlight);
            border-radius: 20px; padding: 25px; box-shadow: var(--glass-shadow);
            text-align: center; animation: fadeIn 0.5s ease; position: relative;
        }

        /* INPUTS */
        .input-group { margin-bottom: 15px; text-align: left; }
        label { display: block; margin-bottom: 5px; font-size: 0.9rem; color: #ccc; }
        input { 
            width: 100%; padding: 15px; border-radius: 12px; border: none; 
            background: rgba(0,0,0,0.3); color: white; font-size: 1rem; outline: none;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* BOT√ïES */
        .btn {
            width: 100%; padding: 15px; border-radius: 12px; border: none;
            color: white; font-weight: 700; font-size: 1rem; cursor: pointer; text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: transform 0.2s; margin-top: 10px;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn:active { transform: scale(0.95); }
        .btn-outline { background: transparent; border: 2px solid rgba(255,255,255,0.2); color: #ddd; }

        /* CORES BOT√ïES */
        .btn-personalizado { background: linear-gradient(90deg, #FFD700, #FFA500); color: #333; animation: glowGold 2s infinite; }
        .btn-saude { background: linear-gradient(90deg, #00b09b, #96c93d); animation: glowGreen 3s infinite; }
        .btn-peso { background: linear-gradient(90deg, #ff416c, #ff4b2b); animation: glowRed 3s infinite; }
        .btn-massa { background: linear-gradient(90deg, #2193b0, #6dd5ed); animation: glowBlue 3s infinite; }
        .btn-rapido { background: linear-gradient(90deg, #f2994a, #f2c94c); color: #333; }
        .btn-fofo { background: linear-gradient(90deg, #ec008c, #fc6767); }
        .btn-fenix { background: linear-gradient(90deg, #800000, #ff0000); border: 1px solid #ffaaaa; animation: glowPulse 1.5s infinite; }

        @keyframes glowGold { 0%, 100% { box-shadow: 0 0 5px #FFD700; } 50% { box-shadow: 0 0 20px #FFD700; } }
        @keyframes glowGreen { 0%, 100% { box-shadow: 0 0 5px #96c93d; } 50% { box-shadow: 0 0 20px #96c93d; } }
        @keyframes glowRed { 0%, 100% { box-shadow: 0 0 5px #ff4b2b; } 50% { box-shadow: 0 0 20px #ff4b2b; } }
        @keyframes glowBlue { 0%, 100% { box-shadow: 0 0 5px #2193b0; } 50% { box-shadow: 0 0 20px #2193b0; } }
        @keyframes glowPulse { 0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); } }

        /* LISTA DE SELE√á√ÉO (NOVO DESIGN) */
        .selection-list { padding-bottom: 60px; }
        
        .select-card {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px; overflow: hidden; margin-bottom: 15px;
            transition: all 0.2s ease; cursor: pointer; text-align: left;
            position: relative;
        }
        
        .select-card img { width: 100%; height: 140px; object-fit: cover; opacity: 0.7; transition: 0.3s; }
        .select-card-body { padding: 15px; }
        .select-card h4 { margin: 0 0 5px 0; font-size: 1rem; color: #fff; }
        .select-card p { margin: 0; font-size: 0.75rem; color: #aaa; line-height: 1.4; }
        
        /* Checkbox Visual */
        .check-circle {
            position: absolute; top: 10px; right: 10px;
            width: 30px; height: 30px; border-radius: 50%;
            background: rgba(0,0,0,0.6); border: 2px solid #fff;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; color: transparent; transition: 0.2s; z-index: 2;
        }

        /* ESTADO SELECIONADO */
        .select-card.active {
            border-color: var(--green-highlight);
            background: rgba(0, 255, 136, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.2);
        }
        .select-card.active img { opacity: 1; }
        .select-card.active .check-circle {
            background: var(--green-highlight); border-color: var(--green-highlight); color: #000;
        }
        .select-card.active .check-circle::after { content: '‚úì'; font-weight: bold; }

        /* BARRA FLUTUANTE (FAB) */
        .floating-action {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 440px; z-index: 100;
            display: flex; gap: 10px;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from { transform: translate(-50%, 100%); } to { transform: translate(-50%, 0); } }

        /* LISTA DE REVIS√ÉO */
        .review-item {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.1); padding: 12px; margin-bottom: 8px;
            border-radius: 10px; text-align: left;
        }
        .btn-remove { 
            background: #ff4444; width: 30px; height: 30px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; font-weight: bold; padding: 0;
        }

        /* TREINO PLAYER */
        .exercise-card { margin-bottom: 20px; text-align: left; padding: 0; overflow: hidden; }
        .ex-img { width: 100%; height: 220px; object-fit: cover; background: #000; }
        .ex-body { padding: 20px; }
        .ex-title { font-size: 1.3rem; font-weight: 800; color: #fff; margin-bottom: 5px; text-transform: uppercase; }
        .ex-meta { display: flex; gap: 10px; margin-bottom: 15px; font-size: 0.8rem; color: #ffaaaa; }
        .ex-desc { font-size: 0.9rem; color: #e0e0e0; line-height: 1.6; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; border-left: 4px solid #ff4444; }

        /* CONTROLES */
        .train-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 15px; }
        .timer-display { grid-column: span 2; font-size: 2.5rem; font-weight: 800; color: white; margin-bottom: 5px; font-variant-numeric: tabular-nums; }
        .btn-start-timer { background: #00aa00; color: white; grid-column: span 2; animation: pulseGreen 1.5s infinite; }
        .btn-stop { background: #cc0000; color: white; display: none; }
        .btn-series { background: #333; color: white; display: none; align-items: center; justify-content: center; }
        .nav-buttons { display: flex; gap: 10px; margin-top: 20px; }

        @keyframes pulseGreen { 0% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(0, 255, 136, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .done-icon { font-size: 4rem; display: block; animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* Grid Simples */
        .grid-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .grid-list { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .option-btn { padding: 15px; background: rgba(0,0,0,0.4); border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); color: #ddd; cursor: pointer; text-align: left; transition: all 0.2s; display: flex; align-items: center; justify-content: space-between; }
        .btn-today { background: linear-gradient(90deg, #006400, #00ff88); border: 2px solid #fff; animation: pulseToday 2s infinite; color: #003300; font-weight: 800; }
        @keyframes pulseToday { 0% { transform: scale(1); } 50% { transform: scale(1.02); box-shadow: 0 0 15px rgba(0,255,136,0.6); } 100% { transform: scale(1); } }

    </style>
</head>
<body>

    <div class="container" id="app"></div>

    <script>
        // --- BANCO DE DADOS DE EXERC√çCIOS (ROBUSTO) ---
        const dbExercicios = {
            cardio: [
                { id: 'c1', nome: "Polichinelos", img: "https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=800", desc: "Mantenha um ritmo constante. Abra bem bra√ßos e pernas." },
                { id: 'c2', nome: "Burpees", img: "https://images.unsplash.com/photo-1599058945522-28d584b6f0ff?w=800", desc: "Movimento completo: agacha, prancha, flex√£o e salto." },
                { id: 'c3', nome: "Corrida Estacion√°ria", img: "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=800", desc: "Eleve os joelhos na altura do quadril rapidamente." },
                { id: 'c4', nome: "Pular Corda", img: "https://images.unsplash.com/photo-1599058945522-28d584b6f0ff?w=800", desc: "Use a ponta dos p√©s. Gire com os punhos." }
            ],
            peito: [
                { id: 'p1', nome: "Supino Reto", img: "https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=800", desc: "Des√ßa a barra no meio do peito. Cotovelos levemente fechados." },
                { id: 'p2', nome: "Supino Inclinado", img: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=800", desc: "Foco na parte superior. Banco a 45 graus." },
                { id: 'p3', nome: "Crucifixo", img: "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=800", desc: "Abra os bra√ßos alongando bem. Feche no centro esmagando." },
                { id: 'p4', nome: "Flex√£o de Bra√ßo", img: "https://images.unsplash.com/photo-1599058945522-28d584b6f0ff?w=800", desc: "Corpo reto. Des√ßa at√© quase encostar no ch√£o." }
            ],
            costas: [
                { id: 'co1', nome: "Puxada Alta", img: "https://images.unsplash.com/photo-1605296867304-46d5465a13f1?w=800", desc: "Traga a barra no peito superior. Feche as esc√°pulas." },
                { id: 'co2', nome: "Remada Baixa", img: "https://images.unsplash.com/photo-1517963879466-e9b5ce382d5d?w=800", desc: "Coluna reta. Puxe em dire√ß√£o ao umbigo." },
                { id: 'co3', nome: "Remada Serrote", img: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=800", desc: "Unilateral. Puxe o halter em dire√ß√£o ao quadril." }
            ],
            pernas: [
                { id: 'pe1', nome: "Agachamento Livre", img: "https://images.unsplash.com/photo-1574680096145-d05b474e2155?w=800", desc: "Agache profundo. Mantenha os calcanhares no ch√£o." },
                { id: 'pe2', nome: "Leg Press 45¬∫", img: "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=800", desc: "N√£o tire a lombar do banco. Empurre com o calcanhar." },
                { id: 'pe3', nome: "Cadeira Extensora", img: "https://images.unsplash.com/photo-1574680096145-d05b474e2155?w=800", desc: "Segure 1 segundo no topo contraindo o quadr√≠ceps." },
                { id: 'pe4', nome: "Mesa Flexora", img: "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=800", desc: "N√£o levante o quadril. Foco total no posterior." }
            ],
            ombros: [
                { id: 'o1', nome: "Desenvolvimento", img: "https://images.unsplash.com/photo-1541534741688-6078c6bfb5c5?w=800", desc: "Empurre para cima da cabe√ßa sem arquear as costas." },
                { id: 'o2', nome: "Eleva√ß√£o Lateral", img: "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=800", desc: "Suba at√© a altura do ombro apenas. Sem balan√ßo." },
                { id: 'o3', nome: "Eleva√ß√£o Frontal", img: "https://images.unsplash.com/photo-1541534741688-6078c6bfb5c5?w=800", desc: "Controle a descida. Mantenha o abd√¥men firme." }
            ],
            bracos: [
                { id: 'b1', nome: "Rosca Direta", img: "https://images.unsplash.com/photo-1581009146145-b5ef050c2e1e?w=800", desc: "B√≠ceps isolado. N√£o balance o tronco." },
                { id: 'b2', nome: "Tr√≠ceps Corda", img: "https://images.unsplash.com/photo-1534367507873-d2d7e24c797f?w=800", desc: "Cotovelos colados no corpo. Abra a corda no final." },
                { id: 'b3', nome: "Rosca Martelo", img: "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=800", desc: "Pegada neutra. Foca no antebra√ßo e braquial." },
                { id: 'b4', nome: "Tr√≠ceps Banco", img: "https://images.unsplash.com/photo-1581009146145-b5ef050c2e1e?w=800", desc: "Des√ßa at√© 90 graus. Mantenha as costas perto do banco." }
            ],
            abdomen: [
                { id: 'a1', nome: "Prancha", img: "https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=800", desc: "Corpo reto. Contraia abd√¥men e gl√∫teo." },
                { id: 'a2', nome: "Abdominal Supra", img: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=800", desc: "Tire apenas as esc√°pulas do ch√£o. Solte o ar." }
            ]
        };

        // --- ESTADO ---
        const state = {
            screen: 'login',
            user: { name: '', sex: '', ageGroup: '', goal: '' },
            currentWorkout: [],
            customSelection: [], 
            currentExerciseIndex: 0,
            startTime: null,
            endTime: null,
            timerInterval: null,
            seconds: 0,
            seriesCount: 0
        };

        const app = document.getElementById('app');

        // --- RENDERIZA√á√ÉO CENTRAL ---
        function render() {
            app.innerHTML = '';
            
            // Header (Sempre presente exceto login)
            const header = document.createElement('div');
            header.className = 'header-nav';
            header.innerHTML = `
                <a href="index.html" class="logo-link"><img src="LogoStudioFenix.png" class="logo"></a>
            `;
            app.appendChild(header);

            if (state.screen === 'login') renderLogin();
            else if (state.screen === 'sex') renderSexSelector();
            else if (state.screen === 'age') renderAgeSelector();
            else if (state.screen === 'goal') renderGoalSelector();
            else if (state.screen === 'day_select') renderDaySelector();
            else if (state.screen === 'build_custom') renderBuildCustom();
            else if (state.screen === 'custom_confirm') renderCustomConfirm();
            else if (state.screen === 'dashboard') renderDashboard();
            else if (state.screen === 'workout') renderWorkoutScreen();
            else if (state.screen === 'summary') renderSummary();
        }

        // TELA 1: LOGIN
        function renderLogin() {
            const div = document.createElement('div');
            div.className = 'glass-card';
            div.innerHTML = `
                <h2 style="color:#fff; margin-bottom:20px;">√Årea do Aluno</h2>
                <div class="input-group"><label>Usu√°rio</label><input type="text" id="username"></div>
                <div class="input-group"><label>Senha</label><input type="password" id="password"></div>
                <button class="btn" style="background:#cc0000;" onclick="handleLogin()">Entrar</button>
                <a href="index.html" class="btn btn-outline" style="text-decoration:none;">Voltar para In√≠cio</a>
            `;
            app.appendChild(div);
        }

        // TELA 2: SEXO
        function renderSexSelector() {
            const div = document.createElement('div');
            div.className = 'glass-card';
            div.innerHTML = `
                <h2>Ol√°, Aluno!</h2><p style="color:#ccc;">Selecione seu sexo:</p>
                <div class="grid-options">
                    <div class="option-btn" onclick="nextStep('sex', 'Masculino')" style="justify-content:center;">üßî Masculino</div>
                    <div class="option-btn" onclick="nextStep('sex', 'Feminino')" style="justify-content:center;">üë© Feminino</div>
                </div>
                <button class="btn btn-outline" onclick="goToScreen('login')">Voltar</button>
            `;
            app.appendChild(div);
        }

        // TELA 3: IDADE
        function renderAgeSelector() {
            const div = document.createElement('div');
            div.className = 'glass-card';
            div.innerHTML = `
                <h2>Faixa Et√°ria</h2>
                <div class="grid-list">
                    <div class="option-btn" onclick="nextStep('ageGroup', 'Crian√ßa')">üë∂ Crian√ßa (at√© 12 anos)</div>
                    <div class="option-btn" onclick="nextStep('ageGroup', 'Jovem')">üë¶ Jovem (13 a 18 anos)</div>
                    <div class="option-btn" onclick="nextStep('ageGroup', 'Adulto')">üë® Adulto (19 a 59 anos)</div>
                    <div class="option-btn" onclick="nextStep('ageGroup', 'Idoso')">üë¥ Idoso (60+ anos)</div>
                </div>
                <button class="btn btn-outline" onclick="goToScreen('sex')">Voltar</button>
            `;
            app.appendChild(div);
        }

        // TELA 4: OBJETIVO (CORES E GLOW)
        function renderGoalSelector() {
            const div = document.createElement('div');
            div.className = 'glass-card';
            div.innerHTML = `
                <h2>Seu Objetivo</h2>
                <div class="grid-list">
                    <div class="btn btn-personalizado" onclick="goToDaySelect()">üìÖ TREINO PERSONALIZADO</div>
                    <div class="btn btn-saude" onclick="setGoalAndGenerate('Sa√∫de')">‚ù§Ô∏è Treino Sa√∫de</div>
                    <div class="btn btn-peso" onclick="setGoalAndGenerate('Perda de Peso')">üî• Perda de Peso</div>
                    <div class="btn btn-massa" onclick="setGoalAndGenerate('Massa Muscular')">üí™ Massa Muscular</div>
                    <div class="btn btn-rapido" onclick="setGoalAndGenerate('R√°pido')">‚ö° Treino R√°pido</div>
                    <div class="btn btn-fofo" onclick="setGoalAndGenerate('Fofo')">üß∏ Treino Fofo</div>
                    <div class="btn btn-fenix" onclick="setGoalAndGenerate('Modo F√™nix')">ü¶Ö MODO F√äNIX</div>
                </div>
                <button class="btn btn-outline" onclick="goToScreen('age')">Voltar</button>
            `;
            app.appendChild(div);
        }

        // TELA 5: SELE√á√ÉO DE DIA OU MONTAR
        function renderDaySelector() {
            const dayOfWeek = new Date().getDay(); 
            const div = document.createElement('div');
            div.className = 'glass-card';
            div.innerHTML = `
                <h2>Personalizado</h2>
                <p style="font-size:0.8rem; color:#aaa;">Escolha o dia ou monte o seu.</p>
                <div class="btn btn-personalizado" style="margin-bottom:20px;" onclick="goToBuildCustom()">
                    üõ†Ô∏è <strong>MONTAR MEU TREINO</strong>
                </div>
                <div class="grid-list">
                    <div class="option-btn ${dayOfWeek === 1 ? 'btn-today' : ''}" onclick="setSpecificWorkout(['peito','bracos'], 'Segunda')">
                        <div>Segunda <small>Peito e Bra√ßos</small></div> ${dayOfWeek === 1 ? 'üìç' : ''}
                    </div>
                    <div class="option-btn ${dayOfWeek === 2 ? 'btn-today' : ''}" onclick="setSpecificWorkout(['costas','abdomen'], 'Ter√ßa')">
                        <div>Ter√ßa <small>Costas e Abd√¥men</small></div> ${dayOfWeek === 2 ? 'üìç' : ''}
                    </div>
                    <div class="option-btn ${dayOfWeek === 3 ? 'btn-today' : ''}" onclick="setSpecificWorkout(['pernas'], 'Quarta')">
                        <div>Quarta <small>Pernas Completas</small></div> ${dayOfWeek === 3 ? 'üìç' : ''}
                    </div>
                    <div class="option-btn ${dayOfWeek === 4 ? 'btn-today' : ''}" onclick="setSpecificWorkout(['ombros','cardio'], 'Quinta')">
                        <div>Quinta <small>Ombros e Cardio</small></div> ${dayOfWeek === 4 ? 'üìç' : ''}
                    </div>
                    <div class="option-btn ${dayOfWeek === 5 ? 'btn-today' : ''}" onclick="setSpecificWorkout(['peito','costas'], 'Sexta')">
                        <div>Sexta <small>Superior Geral</small></div> ${dayOfWeek === 5 ? 'üìç' : ''}
                    </div>
                    <div class="option-btn ${dayOfWeek === 6 ? 'btn-today' : ''}" onclick="setSpecificWorkout(['pernas','abdomen'], 'S√°bado')">
                        <div>S√°bado <small>Inferior e Abd√¥men</small></div> ${dayOfWeek === 6 ? 'üìç' : ''}
                    </div>
                </div>
                <button class="btn btn-outline" onclick="goToScreen('goal')">Voltar</button>
            `;
            app.appendChild(div);
        }

        // TELA 6: MONTAR TREINO (LISTA COM CARDS E CHECKBOX)
        function renderBuildCustom() {
            const div = document.createElement('div');
            // Remove glass-card padrao para usar largura total melhor
            div.innerHTML = `
                <div class="glass-card" style="margin-bottom:10px;">
                    <h2>Selecionar Exerc√≠cios</h2>
                    <p style="font-size:0.8rem; color:#aaa;">Toque nos cards para marcar.</p>
                </div>
                <div class="selection-list" id="selectionList"></div>
            `;
            
            // Bot√£o Flutuante
            const fab = document.createElement('div');
            fab.className = 'floating-action';
            fab.innerHTML = `
                <button class="btn btn-outline" style="flex:1; background:rgba(0,0,0,0.8);" onclick="goToScreen('day_select')">Voltar</button>
                <button class="btn btn-start-timer" style="flex:2; margin-top:0;" onclick="goToCustomConfirm()">
                    REVISAR (${state.customSelection.length})
                </button>
            `;
            
            app.appendChild(div);
            app.appendChild(fab);

            // Popula a lista
            const listContainer = document.getElementById('selectionList');
            
            for (const [key, exercises] of Object.entries(dbExercicios)) {
                // Titulo Categoria
                const catTitle = document.createElement('h3');
                catTitle.style.cssText = "color:#ffaaaa; font-size:0.9rem; margin:15px 0 5px 10px; text-transform:uppercase;";
                catTitle.innerText = key.toUpperCase();
                listContainer.appendChild(catTitle);

                exercises.forEach(ex => {
                    const isSelected = state.customSelection.some(item => item.id === ex.id);
                    
                    const card = document.createElement('div');
                    card.className = `select-card ${isSelected ? 'active' : ''}`;
                    card.onclick = () => toggleExerciseSelection(key, ex.id);
                    card.innerHTML = `
                        <div class="check-circle"></div>
                        <img src="${ex.img}">
                        <div class="select-card-body">
                            <h4>${ex.nome}</h4>
                            <p><strong>Modo:</strong> ${ex.desc}</p>
                        </div>
                    `;
                    listContainer.appendChild(card);
                });
            }
        }

        // TELA 7: CONFIRMA√á√ÉO DA SELE√á√ÉO
        function renderCustomConfirm() {
            const div = document.createElement('div');
            div.className = 'glass-card';
            
            let listHtml = '';
            if(state.customSelection.length === 0) {
                listHtml = '<p style="color:#aaa; padding:20px;">Nenhum exerc√≠cio selecionado.</p>';
            } else {
                state.customSelection.forEach((ex, i) => {
                    listHtml += `
                        <div class="review-item">
                            <div>
                                <strong style="color:#fff; display:block;">${i+1}. ${ex.nome}</strong>
                                <span style="font-size:0.7rem; color:#aaa;">${ex.desc.substring(0,30)}...</span>
                            </div>
                            <button class="btn-remove" onclick="removeExercise('${ex.id}')">X</button>
                        </div>
                    `;
                });
            }

            div.innerHTML = `
                <h2>Seu Treino</h2>
                <p style="color:#aaa; font-size:0.8rem; margin-bottom:15px;">Confira a ordem dos exerc√≠cios.</p>
                
                <div style="max-height:350px; overflow-y:auto; margin-bottom:20px;">
                    ${listHtml}
                </div>

                <button class="btn btn-start-timer" onclick="startCustomWorkout()">INICIAR TREINO AGORA</button>
                <button class="btn btn-outline" onclick="goToScreen('build_custom')">Adicionar Mais</button>
            `;
            app.appendChild(div);
        }

        // TELA 8: DASHBOARD (PREVIEW GERAL)
        function renderDashboard() {
            const div = document.createElement('div');
            div.className = 'glass-card';
            div.innerHTML = `
                <h3 style="color:#aaa; font-size:0.9rem;">Pr√©via Autom√°tica</h3>
                <h1 style="color:#fff; text-transform:uppercase; margin:10px 0;">${state.user.goal}</h1>
                
                <div style="text-align:left; background:rgba(0,0,0,0.3); padding:15px; border-radius:15px; margin-bottom:20px; max-height:300px; overflow-y:auto;">
                    <p style="color:#fff; font-weight:bold;">Exerc√≠cios gerados:</p>
                    <ul style="padding-left:20px; color:#ccc; font-size:0.9rem; margin-top:5px;">
                        ${state.currentWorkout.map(ex => `<li>${ex.nome}</li>`).join('')}
                    </ul>
                </div>

                <button class="btn btn-start-timer" onclick="startWorkout()">COME√áAR TREINO</button>
                <button class="btn btn-outline" onclick="goToScreen('goal')">Trocar Objetivo</button>
            `;
            app.appendChild(div);
        }

        // TELA 9: EXERC√çCIO ATIVO (PLAYER)
        function renderWorkoutScreen() {
            const ex = state.currentWorkout[state.currentExerciseIndex];
            
            let series = "3 S√©ries";
            let reps = "12 Reps";
            
            if(state.user.goal === "Modo F√™nix") { series = "4 S√©ries"; reps = "At√© a falha"; }
            else if(state.user.goal === "Fofo") { series = "2 S√©ries"; reps = "10 Leves"; }

            const div = document.createElement('div');
            div.className = 'glass-card exercise-card';
            div.innerHTML = `
                <img src="${ex.img}" class="ex-img">
                <div class="ex-body">
                    <div class="ex-meta">Exerc√≠cio ${state.currentExerciseIndex + 1} de ${state.currentWorkout.length}</div>
                    <div class="ex-title">${ex.nome}</div>
                    <div class="ex-meta">
                        <span>üìù ${series}</span>
                        <span>üîÑ ${reps}</span>
                    </div>
                    <div class="ex-desc">
                        <strong>Execu√ß√£o:</strong><br>${ex.desc}
                    </div>

                    <div class="train-controls">
                        <div class="timer-display" id="timerDisplay">00:00</div>
                        
                        <button class="btn btn-start-timer" id="btnStart" onclick="toggleTimer(true)">COME√áAR S√âRIE</button>
                        <button class="btn btn-stop" id="btnStop" onclick="toggleTimer(false)">PAUSAR</button>
                        <button class="btn btn-series" id="btnSeries" onclick="addSeries()">
                            ‚úÖ Feita: <span id="seriesVal">0</span>
                        </button>
                    </div>

                    <div class="nav-buttons">
                        ${state.currentExerciseIndex > 0 ? `<button class="btn btn-outline" style="flex:1; margin-top:0;" onclick="prevExercise()">‚¨Ö Anterior</button>` : ''}
                        <button class="btn" style="flex:1; margin-top:0;" onclick="nextExercise()">
                            ${state.currentExerciseIndex < state.currentWorkout.length - 1 ? 'Pr√≥ximo ‚û°' : 'Finalizar üî•'}
                        </button>
                    </div>
                </div>
            `;
            app.appendChild(div);
        }

        // TELA 10: RESUMO FINAL
        function renderSummary() {
            const duration = Math.floor((state.endTime - state.startTime) / 1000 / 60);
            const div = document.createElement('div');
            div.className = 'glass-card';
            div.innerHTML = `
                <span class="done-icon">üéâ</span>
                <h1 style="color:#00ff88; margin-bottom:10px;">TREINO CONCLU√çDO!</h1>
                <p style="color:#fff; margin-bottom:20px;">Voc√™ finalizou o treino ${state.user.goal}.</p>
                <div style="background:rgba(255,255,255,0.1); padding:20px; border-radius:15px; margin-bottom:20px;">
                    <h2 style="color:#fff;">${duration < 1 ? 'Menos de 1' : duration} Minutos</h2>
                    <p style="font-size:0.8rem; color:#aaa;">Tempo Total</p>
                </div>
                <a href="foto.html" class="btn" style="text-decoration:none;">üì∑ Compartilhar</a>
                <button class="btn btn-outline" onclick="location.reload()">Sair</button>
            `;
            app.appendChild(div);
        }

        // --- L√ìGICA DO APP ---

        function handleLogin() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            if(u.toLowerCase() === 'aluno' && p === 'fenix26') {
                state.screen = 'sex';
                render();
            } else {
                alert('Login incorreto.');
            }
        }

        function goToScreen(screenName) {
            state.screen = screenName;
            render();
        }

        function nextStep(field, value) {
            state.user[field] = value;
            if(field === 'sex') state.screen = 'age';
            if(field === 'ageGroup') state.screen = 'goal';
            render();
        }

        function goToDaySelect() {
            state.screen = 'day_select';
            render();
        }

        function goToBuildCustom() {
            state.screen = 'build_custom';
            render();
        }

        function goToCustomConfirm() {
            if (state.customSelection.length === 0) {
                alert("Selecione ao menos um exerc√≠cio.");
                return;
            }
            state.screen = 'custom_confirm';
            render();
        }

        // SELE√á√ÉO MANUAL
        function toggleExerciseSelection(category, id) {
            const exerciseObj = dbExercicios[category].find(e => e.id === id);
            const exists = state.customSelection.some(e => e.id === id);

            if (exists) {
                state.customSelection = state.customSelection.filter(e => e.id !== id);
            } else {
                state.customSelection.push(exerciseObj);
            }
            renderBuildCustom(); // Re-renderiza para mostrar verde
        }

        function removeExercise(id) {
            state.customSelection = state.customSelection.filter(e => e.id !== id);
            renderCustomConfirm();
        }

        function startCustomWorkout() {
            state.user.goal = "Personalizado";
            state.currentWorkout = state.customSelection;
            startWorkout();
        }

        // TREINOS PRONTOS
        function setSpecificWorkout(categories, dayName) {
            state.user.goal = `Treino de ${dayName}`;
            let pool = [];
            categories.forEach(cat => {
                if(dbExercicios[cat]) pool = [...pool, ...dbExercicios[cat]];
            });
            state.currentWorkout = pool.slice(0, 6); // Limita a 6
            state.screen = 'dashboard';
            render();
        }

        function setGoalAndGenerate(goal) {
            state.user.goal = goal;
            let pool = [];
            
            if (goal === 'Modo F√™nix' || goal === 'Massa Muscular') {
                pool = [...dbExercicios.peito, ...dbExercicios.costas, ...dbExercicios.pernas, ...dbExercicios.ombros];
            } else if (goal === 'Sa√∫de' || goal === 'Fofo') {
                pool = [...dbExercicios.cardio, ...dbExercicios.abdomen, ...dbExercicios.mobilidade];
            } else { 
                pool = [...dbExercicios.cardio, ...dbExercicios.pernas, ...dbExercicios.peito];
            }

            state.currentWorkout = pool.sort(() => 0.5 - Math.random()).slice(0, 5);
            state.screen = 'dashboard';
            render();
        }

        function startWorkout() {
            state.startTime = Date.now();
            state.currentExerciseIndex = 0;
            state.screen = 'workout';
            render();
        }

        // TIMER & CONTROLES
        function toggleTimer(start) {
            const btnStart = document.getElementById('btnStart');
            const btnStop = document.getElementById('btnStop');
            const btnSeries = document.getElementById('btnSeries');

            if(start) {
                btnStart.style.display = 'none';
                btnStop.style.display = 'inline-block';
                btnSeries.style.display = 'flex';
                state.timerInterval = setInterval(() => {
                    state.seconds++;
                    const m = Math.floor(state.seconds / 60).toString().padStart(2, '0');
                    const s = (state.seconds % 60).toString().padStart(2, '0');
                    document.getElementById('timerDisplay').innerText = `${m}:${s}`;
                }, 1000);
            } else {
                clearInterval(state.timerInterval);
                btnStart.innerText = "CONTINUAR";
                btnStart.style.display = 'inline-block';
                btnStop.style.display = 'none';
            }
        }

        function addSeries() {
            state.seriesCount++;
            document.getElementById('seriesVal').innerText = state.seriesCount;
        }

        function nextExercise() {
            clearInterval(state.timerInterval);
            state.seconds = 0;
            state.seriesCount = 0;
            if(state.currentExerciseIndex < state.currentWorkout.length - 1) {
                state.currentExerciseIndex++;
                render();
            } else {
                state.endTime = Date.now();
                state.screen = 'summary';
                render();
            }
        }

        function prevExercise() {
            clearInterval(state.timerInterval);
            state.seconds = 0;
            if(state.currentExerciseIndex > 0) {
                state.currentExerciseIndex--;
                render();
            }
        }

        // Start
        render();
    </script>
</body>
</html>